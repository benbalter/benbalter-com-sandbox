{"author":"Benjamin J. Balter","title":"Regular Expression to Parse Word-style Footnotes into WordPress's Simple Footnotes Format","excerpt":"Regular Expression to automatically parse Microsoft Word's footnote format into a more web-friendly format for WordPress's Simple Footnotes plugin","layout":"post","categories":["Technology"],"tags":["code","footnotes","hack","open source","plugin","wordpress"],"post_format":[],"related_posts":[{"url":"/2010/09/12/wordpress-resume-plugin/","id":"/2010/09/12/wordpress-resume-plugin","title":"WordPress Resume Plugin"},{"url":"/2010/09/13/new-media-flak-megaphone-vs-cocktail-party/","id":"/2010/09/13/new-media-flak-megaphone-vs-cocktail-party","title":"New Media Flak: Megaphone vs. Cocktail Party"},{"url":"/2010/10/10/does-every-cloud-have-a-silver-lining/","id":"/2010/10/10/does-every-cloud-have-a-silver-lining","title":"Does Every Cloud Have a Silver Lining?"},{"url":"/2010/11/06/removing-the-barriers-to-organizational-agility/","id":"/2010/11/06/removing-the-barriers-to-organizational-agility","title":"Removing the Barriers to Organizational Agility\n"},{"url":"/2010/11/08/what-fourteen-century-apple-pie-teaches-us-about-sharing/","id":"/2010/11/08/what-fourteen-century-apple-pie-teaches-us-about-sharing","title":"What Fourteen-Century Apple Pie Teaches Us About Sharing\n"},{"url":"/2010/11/15/will-federal-contracting-officers-soon-have-their-heads-in-the-clouds/","id":"/2010/11/15/will-federal-contracting-officers-soon-have-their-heads-in-the-clouds","title":"Will Federal Contracting Officers Soon Have Their Heads in the Clouds?\n"},{"url":"/2010/11/29/free-trade-in-china-just-google-it/","id":"/2010/11/29/free-trade-in-china-just-google-it","title":"Free Trade in China? Just Google it."},{"url":"/2010/11/29/twitter-mentions-as-comments/","id":"/2010/11/29/twitter-mentions-as-comments","title":"Twitter Mentions as Comments WordPress Plugin\n"},{"url":"/2010/12/01/the-internet-is-series-of-tubes/","id":"/2010/12/01/the-internet-is-series-of-tubes","title":"The Internet is Series of Tubes (oh, and Tollgates too)\n"},{"url":"/2010/12/20/late-night-infomercials/","id":"/2010/12/20/late-night-infomercials","title":"Late-Night Infomercials: Guaranteed to Extend the 4th Amendment or Your Money Back"}],"url":"/2011/03/20/regular-expression-to-parse-word-style-footnotes/","date":"2011-03-20 00:00:00 +0000","id":"/2011/03/20/regular-expression-to-parse-word-style-footnotes","next":"/2011/04/04/when-all-you-have-is-a-pair-of-bolt-cutters","previous":"/2011/03/09/craft-your-personal-brand","content":"<p>I needed a quick-and-easy way to parse Microsoft Word&#8217;s footnote format into a more web-friendly format for a recent project. After a bit of regular expression hacking, I was able to build a WordPress plugin to automatically convert content pasted from Word into a format readable by <a href='http://andrewnacin.com'>Andrew Nacin&#8217;s</a> popular <a href='http://andrewnacin.com/2010/07/24/simple-footnotes-0-3/'>Simple Footnotes</a> plugin.</p>\n\n<p>The process is surprisingly simple given <a href='http://codex.wordpress.org/Plugin_API/Filter_Reference'>WordPress&#8217;s extensive filter API</a>. First, to grab the footnotes from Word&#8217;s <code>ftnref</code> format:</p>\n<div>\n<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>\n\n<span class='c1'>//grab all the Word-style footnotes into an array</span>\n<span class='nv'>$pattern</span> <span class='o'>=</span> <span class='s1'>&#39;#&lt;a href\\=&quot;\\#_ftnref([0-9]+)&quot;&gt;\\[([0-9]+)\\]&lt;/a&gt; (.*)#&#39;</span><span class='p'>;</span>\n<span class='nb'>preg_match_all</span><span class='p'>(</span> <span class='nv'>$pattern</span><span class='p'>,</span> <span class='nv'>$content</span><span class='p'>,</span> <span class='nv'>$footnotes</span><span class='p'>,</span> <span class='nx'>PREG_SET_ORDER</span><span class='p'>);</span>\n\n<span class='cp'>?&gt;</span><span class='x' />\n</code></pre></div>\n</div>\n<p>This creates an array (<code>$footnotes</code>) with the both the footnote number and the text of the footnote. We then need a way to replace the in-text reference with the parsed footnotes so that Simple Footnotes can understand them. I did this by creating two arrays, a find array and a replace array with each Word-style footnote reference and its Simple Footnote formatted counterpart:</p>\n<div>\n<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>\n\n<span class='c1'>//build find and replace arrays</span>\n<span class='k'>foreach</span> <span class='p'>(</span><span class='nv'>$footnotes</span> <span class='k'>as</span> <span class='nv'>$footnote</span><span class='p'>)</span> <span class='p'>{</span>\n  <span class='nv'>$find</span><span class='p'>[]</span> <span class='o'>=</span> <span class='s1'>&#39;#&lt;a href\\=&quot;\\#_ftn&#39;</span><span class='o'>.</span><span class='nv'>$footnote</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]</span><span class='o'>.</span><span class='s1'>&#39;&quot;&gt;\\[&#39;</span><span class='o'>.</span><span class='nv'>$footnote</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]</span><span class='o'>.</span><span class='s1'>&#39;\\]&lt;/a&gt;#&#39;</span><span class='p'>;</span>\n  <span class='nv'>$replace</span><span class='p'>[]</span> <span class='o'>=</span> <span class='s1'>&#39;[ref]&#39;</span> <span class='o'>.</span> <span class='nb'>str_replace</span><span class='p'>(</span> <span class='k'>array</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='se'>\\r\\n</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\\r</span><span class='s2'>&quot;</span><span class='p'>,</span> <span class='s2'>&quot;</span><span class='se'>\\n</span><span class='s2'>&quot;</span><span class='p'>),</span> <span class='s2'>&quot;&quot;</span><span class='p'>,</span>   <span class='nv'>$footnote</span><span class='p'>[</span><span class='mi'>3</span><span class='p'>])</span> <span class='o'>.</span> <span class='s1'>&#39;[/ref]&#39;</span><span class='p'>;</span>\n<span class='p'>}</span>   \n\n<span class='cp'>?&gt;</span><span class='x' />\n</code></pre></div>\n</div>\n<p>Finally, so that the entire replacement can be done in a single pass, push a final find/replace pair into the end of the array, to remove the original footnotes:</p>\n<div>\n<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>\n\n    <span class='c1'>//remove all the original footnotes when done</span>\n    <span class='nv'>$find</span><span class='p'>[]</span> <span class='o'>=</span> <span class='s1'>&#39;#&lt;div&gt;\\s*&lt;a href\\=&quot;\\#_ftnref([0-9]+)&quot;&gt;\\[([0-9]+)\\]&lt;/a&gt; (.*)\\s*&lt;/div&gt;\\s+#&#39;</span><span class='p'>;</span>\n    <span class='nv'>$replace</span><span class='p'>[]</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>;</span>\n\n<span class='cp'>?&gt;</span><span class='x' />\n</code></pre></div>\n</div>\n<p>Because PHP&#8217;s <code>preg_replace</code> function can handle arrays, all we have to do is run a single function:</p>\n<div>\n<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>\n\n<span class='nv'>$content</span> <span class='o'>=</span> <span class='nb'>preg_replace</span><span class='p'>(</span> <span class='nv'>$find</span><span class='p'>,</span> <span class='nv'>$replace</span><span class='p'>,</span> <span class='nv'>$content</span> <span class='p'>);</span>\n\n<span class='cp'>?&gt;</span><span class='x' />\n</code></pre></div>\n</div>\n<p>Putting it all together, including a filter hook to call our function and a <code>meta_value</code> flag to prevent parsing on subsequent saves, the result is:</p>\n<script src='http://gist-it.appspot.com/github/benbalter/Convert-Microsoft-Word-Footnotes-to-WordPress-Simple-Footnotes/raw/master/parse-footnotes.php'>     </script>\n<p>To use, you can <a href='https://github.com/benbalter/Convert-Microsoft-Word-Footnotes-to-WordPress-Simple-Footnotes'>download the plugin file</a><sup id='fnref:1'><a href='#fn:1' rel='footnote'>1</a></sup> and activate (be sure you already have <a href='http://andrewnacin.com/2010/07/24/simple-footnotes-0-3/'>Simple Footnotes</a> installed). Copy the content from Word, and Paste into the &#8221;<em>Paste from Word</em>&#8221; box (may need to toggle the &#8221;<a href='http://www.bloggingteacher.com/writing-posts-with-the-wordpress-visual-editor-the-kitchen-sink'><em>Kitchen Sink</em></a>&#8221;.<sup id='fnref:2'><a href='#fn:2' rel='footnote'>2</a></sup></p>\n\n<p>Thoughts? Improvements? The above code solved a rather stubborn workflow problem in a project I was working on, and hopefully it can do the same for you. Feel free to use/improve the above code.</p>\n<div class='footnotes'><hr /><ol><li id='fn:1'>\n<p>Licensed under <a href='http://wordpress.org/about/gpl/'>GPLv2</a></p>\n<a href='#fnref:1' rev='footnote'>&#8617;</a></li><li id='fn:2'>\n<p>You can even <a href='http://ben.balter.com/2011/03/20/regular-expression-to-parse-word-style-footnotes/'>Fork the plugin over on Github</a></p>\n<a href='#fnref:2' rev='footnote'>&#8617;</a></li></ol></div>"}